---
layout: post
title: "Getting Started with SeaORM"
categories: guides
author: Anshul Chauhan
syntax: True
tags: rust sqlite
---

{{ page.date | date_to_long_string }}
{:.muted}

The official docs of SeaORM can be found [here](https://www.sea-ql.org/SeaORM/docs/index/).

This post has taken direct inspiration from Diesel-rs and ported their
[getting-started](https://diesel.rs/guides/getting-started) guide for SeaORM.
In this guide we're going to build simple examples of each pieces of CRUD operations.

**This guide assumes that you're using SQLite.** Before we start make sure you
have [libsqlite3](https://www.sqlite.org/index.html) installed for you system.

For this guide I am using [Rust](https://www.rust-lang.org/)v1.62.0

## Initialize a new project

```txt
cargo new seaorm_demo --lib
cd seaorm_demo
```

First, let's add SeaORM to our dependencies.

File: `Cargo.toml`
{:.muted}
```toml
[dependencies.sea-orm]
version = "0.8"
features = [ "sqlx-sqlite", "runtime-tokio-rustls", "macros" ]
default-features = false
```

## Installing sea-orm-cli and Migration

```txt
cargo install sea-orm-cli
```

We'll write a migration file to setup our database and table schema.

```txt
sea-orm-cli migrate init
```

This would have generated a module `migration` and now our project file structure is looking like
```txt
.
├── Cargo.lock
├── Cargo.toml
├── migration
│   ├── Cargo.toml
│   ├── README.md
│   └── src
│       ├── lib.rs
│       ├── m20220101_000001_create_table.rs
│       └── main.rs
└── src
    └── lib.rs
```

Open the file `migration/Cargo.toml` and uncomment the two dependencies for `sea-orm-migration`.

File: `migration/Cargo.toml`
{:.muted}

```toml
[dependencies.sea-orm-migration]
version = "^0.9.0"
features = [
  # Enable at least one `ASYNC_RUNTIME` and `DATABASE_DRIVER` feature if you want to run migration via CLI.
  # View the list of supported features at https://www.sea-ql.org/SeaORM/docs/install-and-config/database-and-async-runtime.
  # e.g.
   "runtime-tokio-rustls",  # `ASYNC_RUNTIME` featrure
   "sqlx-sqlite",         # `DATABASE_DRIVER` feature
]
```

Edit the file `migration/src/m20220101_000001_create_table.rs` in your
favourite editor and remove the two mentions of `todo!()` and save the file.

Set the url for your database as an environment varibale.

```txt
export DATABASE_URL='sqlite://posts.sqlite?mode=rwc'
```

Next, we'll run the migration.

```txt
sea-orm-cli migrate up
```

This will compile the `migration` module and run your migrations. After this
has run successfully you should see a file named `posts.sqlite` in your directory.

You can check if your table has been created.

```txt
$ sqlite3 posts.sqlite ".schema post" ".exit"

CREATE TABLE IF NOT EXISTS "post" ( "id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "title" text NOT NULL, "text" text NOT NULL );
```

## Generate entities

Create a new `entity` module

```txt
cargo new entity --lib
```

Next generate the entities

```txt
sea-orm-cli generate entity -o entity/src
```

This will use the database we created earlier, by reading the `DATABASE_URL`
environment variable.

Add the `sea-orm` dependency to `entity`.

File: `entity/Cargo.toml`
{:.muted}

```toml
[dependencies]
sea-orm = { version = "0.8" }
```

File: `entity/src/post.rs`
{:.muted}

{% highlight rust %}
//! SeaORM Entity. Generated by sea-orm-codegen 0.9.0

use sea_orm::entity::prelude::*;

#[derive(Clone, Debug, PartialEq, DeriveEntityModel)]
#[sea_orm(table_name = "post")]
pub struct Model {
    #[sea_orm(primary_key)]
    pub id: i32,
    pub title: String,
    pub text: String,
}

#[derive(Copy, Clone, Debug, EnumIter)]
pub enum Relation {}

impl RelationTrait for Relation {
    fn def(&self) -> RelationDef {
        panic!("No RelationDef")
    }
}

impl ActiveModelBehavior for ActiveModel {}
{% endhighlight %}

- write about creating a database connection
- show what the current dir structure is like

## Setup SeaORM for your project

## Create

## Read

## Update

## Delete

## Etc

- Entire code for this tutorial can be found [here](https://github.com/anshulxyz/seaorm_demo)
- More SeaORM [examples](https://github.com/SeaQL/sea-orm/tree/master/examples) can be found on their [github repo](https://github.com/SeaQL/sea-orm)
- Invite to their discord server
